(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{706:function(s,a,n){"use strict";n.r(a);var t=n(20),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"百度智能小程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#百度智能小程序"}},[s._v("#")]),s._v(" 百度智能小程序")]),s._v(" "),n("p",[s._v("命令行工具: "),n("a",{attrs:{href:"https://smartprogram.baidu.com/docs/develop/devtools/commandtool/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://smartprogram.baidu.com/docs/develop/devtools/commandtool/"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i swan-toolkit -g\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("亦可局部安装，通过 "),n("code",[s._v("npx")]),s._v(" 或 "),n("code",[s._v("node_modules/.bin/swan")]),s._v(" 执行。")]),s._v(" "),n("p",[s._v("我们这里采用局部安装，使用npx 的形式代理 node_modules/.bin 的方式执行命令\nnpx 是什么及使用方式具体参考： "),n("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2019/02/npx.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.ruanyifeng.com/blog/2019/02/npx.html"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("安装完成后便可使用 swan 命令, 在文档的下方可以找到我们需要的发布功能")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("swan upload --project-path /path/to/your/project --token THE_TOKEN_WITH_PREVIEW_AUTHORIZATION --release-version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0.0 --desc description\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("具体参数参考官方文档")]),s._v(" "),n("p",[s._v("||~参数名||必填||说明||\n||"),n("code",[s._v("-p, --project-path")]),s._v("||必填||小程序项目源码路径，可为相对路径或绝对路径。||\n||"),n("code",[s._v("--token")]),s._v("||必填||有该小程序发布权限的登录密钥。||\n||"),n("code",[s._v("--base64")]),s._v("||选填||输出 base64 格式的预览二维码图片。||\n||"),n("code",[s._v("--json")]),s._v("||选填||只以 json 格式输出最终结果，推荐在集成构建中使用。||\n||"),n("code",[s._v("-V, --verbose")]),s._v("||选填||输出日志||\n||"),n("code",[s._v("--game")]),s._v("||选填||小游戏预览，从 2.4.10 版本开始支持||")]),s._v(" "),n("ul",[n("li",[s._v("登录密钥因为涉及到个人账户的身份认证，在用于公共机器构建流水线时，建议使用独立开发账号的登录密钥，并做好用户隔离和安全保护，定期修改账户密码。")]),s._v(" "),n("li",[s._v('登录密钥获取方式：在百度智能小程序开发者工具（版本高于 2.4.1）中登录后，可通过"菜单-关于-复制登录密钥"获取。')])]),s._v(" "),n("p",[s._v("我们当发布小程序时都需要一个版本号，这个参数是必填的，那么如何在流水线工具执行npm命令时使用我们想要的版本号呢？\n其实在package.json 文件中的字段会被注册到环境变量中，是可以直接通过 npm_package_字段名 获取使用的\n"),n("strong",[s._v("使用bash Shell（例如Linux，macOS）：")])]),s._v(" "),n("p",[n("code",[s._v("$npm_package_version")])]),s._v(" "),n("p",[n("strong",[s._v("使用Windows（例如cmd.exe，Powershell）：")])]),s._v(" "),n("p",[n("code",[s._v("%npm_package_version%")])]),s._v(" "),n("p",[s._v("在package.json中写入命令")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"upload:baidu"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npx swan upload --project-path ./dist/build/mp-baidu/ --token XXX --release-version $npm_package_version"')]),s._v("\n \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  \t...\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("那么现在的思路就非常明确了，code push > code build > code upload ,只要按顺序执行命令就好了")]),s._v(" "),n("h2",{attrs:{id:"微信小程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序"}},[s._v("#")]),s._v(" 微信小程序")]),s._v(" "),n("p",[s._v("也是一样我们打开微信小程序的开发文档寻找命令行工具 ,在工具一栏也找到了命令行调用的选项\n"),n("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/devtools/cli.html#%E8%87%AA%E5%8A%A8%E9%A2%84%E8%A7%88",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://developers.weixin.qq.com/miniprogram/dev/devtools/cli.html#自动预览"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("但是仔细阅读文档后发现不能通过局部安装开发工具，先要安装完成工具并且要打开服务端口设置，这显然和我们的构建有所冲突\n开始寻找其它方法，发现文档的有一栏名为 cl 点击进去发现是一个名为 miniprogram-ci 的npm 包\n"),n("a",{attrs:{href:"https://www.npmjs.com/package/miniprogram-ci",target:"_blank",rel:"noopener noreferrer"}},[s._v("miniprogram-ci"),n("OutboundLink")],1),s._v(" 是从"),n("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/devtools/devtools.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("微信开发者工具"),n("OutboundLink")],1),s._v("中抽离的关于小程序/小游戏项目代码的编译模块。\n往下翻发现该包有命令行调用和脚本两种方式 ， 这下正中下怀！，我们选择命令行的方式调用就可以了 ，不过需要注意的是官方说明需要配置好ip白名单并且下载好密钥才能调用")]),s._v(" "),n("h2",{attrs:{id:"密钥及-ip-白名单配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#密钥及-ip-白名单配置"}},[s._v("#")]),s._v(" 密钥及 IP 白名单配置")]),s._v(" "),n("p",[s._v('使用 miniprogram-ci 前应访问"'),n("a",{attrs:{href:"https://mp.weixin.qq.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("微信公众平台"),n("OutboundLink")],1),s._v('-开发-开发设置"后下载代码上传密钥，并配置 IP 白名单 开发者可选择打开 IP 白名单，打开后只有白名单中的 IP 才能调用相关接口。我们建议所有开发者默认开启这个选项，降低风险 代码上传密钥拥有预览、上传代码的权限，密钥不会明文存储在微信公众平台上，一旦遗失必须重置，请开发者妥善保管')]),s._v(" "),n("p",[s._v("由于我们的服务器ip不是固定的所以打开微信公众平台直接关闭ip白名单，直接下载密钥文件调用就可以了\n和百度一样我们使用局部安装开发者工具,使用npx 来调用命令")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" miniprogram-ci\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("官方文档命令行的参数没有标注出来 可以使用 -- help 来查看具体的参数")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# help")]),s._v("\nnpx miniprogram-ci --help\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("和上面一样在package.json 文件中加入命令")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"wechatAppid"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"upload:baidu"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npx swan upload --project-path ./dist/build/mp-baidu/ --token XXX --release-version $npm_package_version"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"upload:wechat"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npx miniprogram-ci upload --uv $npm_package_version --appid $npm_package_wechatAppid --project-path ./dist/build/mp-weixin/ --private-key-path ./private.key"')]),s._v("\n \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  \t...\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("code",[s._v("-- private-key-path")]),s._v("  参数就是密钥文件的路径")]),s._v(" "),n("p",[s._v("至此已配置好所有参数 , 只需要在流水线工具上配置好命令步骤执行即可")]),s._v(" "),n("p",[s._v("因为小程序的某些包直接使用cnpm 下载下来会有问题，所以每次设置淘宝镜像就好 "),n("code",[s._v("npm config set registry [http://registry.npm.taobao.org](http://registry.npm.taobao.org)")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" registry http://registry.npm.taobao.org\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run buildtest:mp-weixin\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run buildtest:mp-baidu\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run upload:wechat\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run upload:baidu\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);